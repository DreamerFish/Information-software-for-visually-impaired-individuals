"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports[Symbol.toStringTag]="Module";var e=require("./common/vendor.js");Math;let t={timeout:1e5,timeoutObj:null,serverTimeoutObj:null,reset:function(){return clearTimeout(this.timeoutObj),clearTimeout(this.serverTimeoutObj),this},start:function(){this.timeoutObj=setTimeout((()=>{e.index.sendSocketMessage({data:JSON.stringify({msg:"ping",toUser:"root"})}),this.serverTimeoutObj=setTimeout((()=>{e.index.closeSocket()}),this.timeout)}),this.timeout)}};const o={onLaunch:function(){this.connectStart()},onShow:function(){console.log("App Show")},onHide:function(){console.log("App Hide")},methods:{connectStart(){e.index.connectSocket({url:"wss://www.gdouhc.top/blind/api/web",success:e=>{console.log("进入聊天",e),this.onSocketMessage()},fail:t=>{e.index.showToast({title:"网络异常!"}),console.log(t)}})},onSocketMessage(){e.index.onSocketOpen((function(e){console.log("WebSocket连接已打开！"),t.reset().start()})),e.index.onSocketError((e=>{console.log("websocket连接失败",e),this.reconnect()})),e.index.onSocketClose((e=>{console.log("WebSocket 已关闭！"),this.reconnect()}))},reconnect(){console.log("重新连接"),this.lockReconnect=!0,clearTimeout(this.timer),this.timer=setTimeout((()=>{this.connectStart()}),5e3)}}};function n(){return{app:e.createSSRApp(o)}}n().app.mount("#app"),exports.createApp=n;
