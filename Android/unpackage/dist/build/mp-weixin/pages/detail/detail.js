"use strict";var e=require("../../common/vendor.js"),t=require("../../utils/request.js");const i={data:()=>({info:[],audioNesw:"",state:!1,newTime:0,newsInfo:"",newsNow:{},color:["#FBACA3","#FCC59F","#FFCF8B","#FCE996","#FDFA94","#DCF190","#7BE188","#89E9E0","#9FD4FD","#94BFFF"]}),onLoad(t){this.backgroundAudio(),this.title=t.sort,e.index.setNavigationBarTitle({title:t.sort}),this.news(t.sort),e.index.onSocketMessage((e=>{console.log("收到服务器内容：",JSON.parse(e.data)),null!=JSON.parse(e.data).Bytext?this.info=this.info.concat(JSON.parse(e.data).Bytext):this.voice=JSON.parse(e.data).ByVoice,this.audio()}))},onPullDownRefresh(){this.info=[],this.news(this.title),this.serialNumber=0},onReachBottom(){console.log(555)},onUnload(t){console.log(t,"页面卸载"),e.index.$emit("news",{newsNow:{newsNow:this.newsNow,audioNesw:this.audioNesw,newTime:this.newTime}})},methods:{news(e){t.get({url:"/news/sendTypeToDeepin",data:{typeName:e}}).then((e=>{console.log(e)}))},audio(e){console.log("音频获取");const{newsId:i,newsTitle:s,newsContent:a}=this.info[e||0];this.newsNow=this.info[e||0],console.log(this.newsNow),t.post({url:"/news/createToVoice",data:{native_voice_name:"xiaoyan",newsId:i,newsContent:a,newsTitle:s,speed:100,volume:0}}).then((e=>{console.log(e.data.data.data),this.audioNesw=e.data.data.data}))},change(e){this.bgAudioManager.stop(),this.bgAudioManager=null,this.backgroundAudio(),this.audioNesw="",this.state=!1,console.log(this.newTime,this.audioNesw,this.state),this.bgAudioManager.pause(),this.audio(e.detail.current),this.newTime=0,e.detail.current==this.info.length-2&&(console.log("获取新数据"),this.news())},backgroundAudio(){this.bgAudioManager=e.index.getBackgroundAudioManager(),this.bgAudioManager.startTime=0},bindstate(e){this.state=e,e?(isNaN(this.newTime)&&(this.newTime=0),console.log("播放",this.newTime,this.audioNesw),0!=this.newTime?(this.bgAudioManager.play(),this.newTime=0):(this.bgAudioManager.src=this.audioNesw,this.bgAudioManager.title=this.newsNow.newsTitle,this.bgAudioManager.singer="暂无",this.bgAudioManager.coverImgUrl="https://bjetxgzv.cdn.bspapp.com/VKCEYUGU-uni-app-doc/7fbf26a0-4f4a-11eb-b680-7980c8a877b8.png",this.newTime=0,this.bgAudioManager.play())):this.bgAudioManager.pause();const t=this;this.bgAudioManager.onTimeUpdate((e=>{t.outTimes()}))},outTimes(){let e=this.bgAudioManager.duration,t=this.bgAudioManager.currentTime;this.newTime=parseInt(parseInt(t)/parseInt(e)*100),this.newTime>=100&&(this.bgAudioManager.startTime=0)},sliderChange(e){console.log(e.detail.value);let t=this.bgAudioManager.duration;this.newTime=e.detail.value,this.bgAudioManager.seek(parseInt(parseInt(t)*parseInt(e.detail.value)/100))}}};var s=e._export_sfc(i,[["render",function(t,i,s,a,n,o){return{a:e.f(n.info,((t,i,s)=>e.e({a:e.t(t.newsId),b:e.t(t.newsTitle),c:e.t(t.newsContent)},n.state?{d:e.o((e=>o.bindstate(!1)))}:{},n.state?{}:{e:e.o((e=>o.bindstate(!0)))},{f:i}))),b:n.newTime,c:e.o(((...e)=>o.sliderChange&&o.sliderChange(...e))),d:n.state,e:!n.state,f:e.o(((...e)=>o.change&&o.change(...e)))}}]]);wx.createPage(s);
